<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>v8: src/fast-dtoa.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../v8-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">v8
   &#160;<span id="projectnumber">3.25.30(node0.11.13)</span>
   </div>
   <div id="projectbrief">V8 is Google&#39;s open source JavaScript engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d2d/fast-dtoa_8cc_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fast-dtoa.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/d2d/fast-dtoa_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2011 the V8 project authors. All rights reserved.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// met:</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//     * Redistributions in binary form must reproduce the above</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//       copyright notice, this list of conditions and the following</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//       disclaimer in the documentation and/or other materials provided</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//       with the distribution.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//     * Neither the name of Google Inc. nor the names of its</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//       from this software without specific prior written permission.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;../include/v8stdint.h&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/checks_8h.html">checks.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">utils.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/df7/fast-dtoa_8h.html">fast-dtoa.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d1a/cached-powers_8h.html">cached-powers.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d85/diy-fp_8h.html">diy-fp.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d6e/double_8h.html">double.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">namespace </span>v8 {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">namespace </span>internal {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// The minimal and maximal target exponent define the range of w&#39;s binary</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// exponent, where &#39;w&#39; is the result of multiplying the input by a cached power</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// of ten.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// A different range might be chosen on a different platform, to optimize digit</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">// generation, but a smaller range requires more powers of ten to be cached.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMinimalTargetExponent = -60;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMaximalTargetExponent = -32;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// Adjusts the last digit of the generated number, and screens out generated</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// solutions that may be inaccurate. A solution may be inaccurate if it is</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// outside the safe interval, or if we ctannot prove that it is closer to the</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// input than a neighboring representation of the same length.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// Input: * buffer containing the digits of too_high / 10^kappa</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">//        * the buffer&#39;s length</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//        * distance_too_high_w == (too_high - w).f() * unit</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//        * unsafe_interval == (too_high - too_low).f() * unit</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//        * rest = (too_high - buffer * 10^kappa).f() * unit</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">//        * ten_kappa = 10^kappa * unit</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">//        * unit = the common multiplier</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// Output: returns true if the buffer is guaranteed to contain the closest</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//    representable number to the input.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">//  Modifies the generated digits in the buffer to approach (round towards) w.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> RoundWeed(Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                      <span class="keywordtype">int</span> length,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                      uint64_t distance_too_high_w,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                      uint64_t unsafe_interval,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                      uint64_t rest,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                      uint64_t ten_kappa,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                      uint64_t unit) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  uint64_t small_distance = distance_too_high_w - unit;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  uint64_t big_distance = distance_too_high_w + unit;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// Let w_low  = too_high - big_distance, and</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">//     w_high = too_high - small_distance.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// Note: w_low &lt; w &lt; w_high</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// The real w (* unit) must lie somewhere inside the interval</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// ]w_low; w_high[ (often written as &quot;(w_low; w_high)&quot;)</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// Basically the buffer currently contains a number in the unsafe interval</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// ]too_low; too_high[ with too_low &lt; w &lt; too_high</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">//  too_high - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">//                     ^v 1 unit            ^      ^                 ^      ^</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">//  boundary_high ---------------------     .      .                 .      .</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">//                     ^v 1 unit            .      .                 .      .</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">//   - - - - - - - - - - - - - - - - - - -  +  - - + - - - - - -     .      .</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">//                                          .      .         ^       .      .</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">//                                          .  big_distance  .       .      .</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">//                                          .      .         .       .    rest</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//                              small_distance     .         .       .      .</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">//                                          v      .         .       .      .</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">//  w_high - - - - - - - - - - - - - - - - - -     .         .       .      .</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//                     ^v 1 unit                   .         .       .      .</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">//  w ----------------------------------------     .         .       .      .</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">//                     ^v 1 unit                   v         .       .      .</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">//  w_low  - - - - - - - - - - - - - - - - - - - - -         .       .      .</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">//                                                           .       .      v</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">//  buffer --------------------------------------------------+-------+--------</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//                                                           .       .</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">//                                                  safe_interval    .</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">//                                                           v       .</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -     .</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">//                     ^v 1 unit                                     .</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">//  boundary_low -------------------------                     unsafe_interval</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//                     ^v 1 unit                                     v</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">//  too_low  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// Note that the value of buffer could lie anywhere inside the range too_low</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// to too_high.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// boundary_low, boundary_high and w are approximations of the real boundaries</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// and v (the input number). They are guaranteed to be precise up to one unit.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// In fact the error is guaranteed to be strictly less than one unit.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// Anything that lies outside the unsafe interval is guaranteed not to round</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// to v when read again.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// Anything that lies inside the safe interval is guaranteed to round to v</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// when read again.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// If the number inside the buffer lies inside the unsafe interval but not</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// inside the safe interval then we simply do not know and bail out (returning</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// false).</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// Similarly we have to take into account the imprecision of &#39;w&#39; when finding</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// the closest representation of &#39;w&#39;. If we have two potential</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// representations, and one is closer to both w_low and w_high, then we know</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// it is closer to the actual value v.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// By generating the digits of too_high we got the largest (closest to</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// too_high) buffer that is still in the unsafe interval. In the case where</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// w_high &lt; buffer &lt; too_high we try to decrement the buffer.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// This way the buffer approaches (rounds towards) w.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// There are 3 conditions that stop the decrementation process:</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">//   1) the buffer is already below w_high</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">//   2) decrementing the buffer would make it leave the unsafe interval</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">//   3) decrementing the buffer would yield a number below w_high and farther</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">//      away than the current number. In other words:</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">//              (buffer{-1} &lt; w_high) &amp;&amp; w_high - buffer{-1} &gt; buffer - w_high</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// Instead of using the buffer directly we use its distance to too_high.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// Conceptually rest ~= too_high - buffer</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// We need to do the following tests in this order to avoid over- and</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// underflows.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(rest &lt;= unsafe_interval);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">while</span> (rest &lt; small_distance &amp;&amp;  <span class="comment">// Negated condition 1</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;         unsafe_interval - rest &gt;= ten_kappa &amp;&amp;  <span class="comment">// Negated condition 2</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;         (rest + ten_kappa &lt; small_distance ||  <span class="comment">// buffer{-1} &gt; w_high</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          small_distance - rest &gt;= rest + ten_kappa - small_distance)) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    buffer[length - 1]--;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    rest += ten_kappa;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// We have approached w+ as much as possible. We now test if approaching w-</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// would require changing the buffer. If yes, then we have two possible</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// representations close to w, but we cannot decide which one is closer.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">if</span> (rest &lt; big_distance &amp;&amp;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      unsafe_interval - rest &gt;= ten_kappa &amp;&amp;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      (rest + ten_kappa &lt; big_distance ||</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;       big_distance - rest &gt; rest + ten_kappa - big_distance)) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// Weeding test.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">//   The safe interval is [too_low + 2 ulp; too_high - 2 ulp]</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">//   Since too_low = too_high - unsafe_interval this is equivalent to</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">//      [too_high - unsafe_interval + 4 ulp; too_high - 2 ulp]</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">//   Conceptually we have: rest ~= too_high - buffer</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">return</span> (2 * unit &lt;= rest) &amp;&amp; (rest &lt;= unsafe_interval - 4 * unit);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">// Rounds the buffer upwards if the result is closer to v by possibly adding</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">// 1 to the buffer. If the precision of the calculation is not sufficient to</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">// round correctly, return false.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">// The rounding might shift the whole buffer in which case the kappa is</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">// adjusted. For example &quot;99&quot;, kappa = 3 might become &quot;10&quot;, kappa = 4.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// If 2*rest &gt; ten_kappa then the buffer needs to be round up.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">// rest can have an error of +/- 1 unit. This function accounts for the</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">// imprecision and returns false, if the rounding direction cannot be</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">// unambiguously determined.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">// Precondition: rest &lt; ten_kappa.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> RoundWeedCounted(Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                             <span class="keywordtype">int</span> length,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                             uint64_t rest,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                             uint64_t ten_kappa,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                             uint64_t unit,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                             <span class="keywordtype">int</span>* kappa) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(rest &lt; ten_kappa);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// The following tests are done in a specific order to avoid overflows. They</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// will work correctly with any uint64 values of rest &lt; ten_kappa and unit.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// If the unit is too big, then we don&#39;t know which way to round. For example</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// a unit of 50 means that the real number lies within rest +/- 50. If</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">// 10^kappa == 40 then there is no way to tell which way to round.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">if</span> (unit &gt;= ten_kappa) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">// Even if unit is just half the size of 10^kappa we are already completely</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">// lost. (And after the previous test we know that the expression will not</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">// over/underflow.)</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (ten_kappa - unit &lt;= unit) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// If 2 * (rest + unit) &lt;= 10^kappa we can safely round down.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span> ((ten_kappa - rest &gt; rest) &amp;&amp; (ten_kappa - 2 * rest &gt;= 2 * unit)) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="comment">// If 2 * (rest - unit) &gt;= 10^kappa, then we can safely round up.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">if</span> ((rest &gt; unit) &amp;&amp; (ten_kappa - (rest - unit) &lt;= (rest - unit))) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// Increment the last digit recursively until we find a non &#39;9&#39; digit.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    buffer[length - 1]++;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = length - 1; i &gt; 0; --i) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">if</span> (buffer[i] != <span class="charliteral">&#39;0&#39;</span> + 10) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      buffer[i] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      buffer[i - 1]++;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// If the first digit is now &#39;0&#39;+ 10 we had a buffer with all &#39;9&#39;s. With the</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// exception of the first digit all digits are now &#39;0&#39;. Simply switch the</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// first digit to &#39;1&#39; and adjust the kappa. Example: &quot;99&quot; becomes &quot;10&quot; and</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// the power (the kappa) is increased.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (buffer[0] == <span class="charliteral">&#39;0&#39;</span> + 10) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      buffer[0] = <span class="charliteral">&#39;1&#39;</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      (*kappa) += 1;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen4 = 10000;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen5 = 100000;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen6 = 1000000;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen7 = 10000000;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen8 = 100000000;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint32_t kTen9 = 1000000000;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">// Returns the biggest power of ten that is less than or equal than the given</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">// number. We furthermore receive the maximum number of bits &#39;number&#39; has.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">// If number_bits == 0 then 0^-1 is returned</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">// The number of bits must be &lt;= 32.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">// Precondition: number &lt; (1 &lt;&lt; (number_bits + 1)).</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> BiggestPowerTen(uint32_t number,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                            <span class="keywordtype">int</span> number_bits,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                            uint32_t* power,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                            <span class="keywordtype">int</span>* exponent) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">switch</span> (number_bits) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">case</span> 32:</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">case</span> 31:</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">case</span> 30:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (kTen9 &lt;= number) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        *power = kTen9;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        *exponent = 9;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">case</span> 29:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">case</span> 28:</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">case</span> 27:</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">if</span> (kTen8 &lt;= number) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        *power = kTen8;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        *exponent = 8;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">case</span> 26:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">case</span> 25:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">case</span> 24:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keywordflow">if</span> (kTen7 &lt;= number) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        *power = kTen7;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        *exponent = 7;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">case</span> 23:</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">case</span> 22:</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">case</span> 21:</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">case</span> 20:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">if</span> (kTen6 &lt;= number) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        *power = kTen6;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        *exponent = 6;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">case</span> 19:</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">case</span> 18:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">case</span> 17:</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">if</span> (kTen5 &lt;= number) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        *power = kTen5;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        *exponent = 5;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">case</span> 16:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">case</span> 15:</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">case</span> 14:</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> (kTen4 &lt;= number) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        *power = kTen4;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        *exponent = 4;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">case</span> 13:</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">case</span> 12:</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">case</span> 11:</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">case</span> 10:</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">if</span> (1000 &lt;= number) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        *power = 1000;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        *exponent = 3;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">case</span> 9:</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">case</span> 7:</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">if</span> (100 &lt;= number) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        *power = 100;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        *exponent = 2;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">case</span> 6:</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">if</span> (10 &lt;= number) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        *power = 10;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        *exponent = 1;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">if</span> (1 &lt;= number) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        *power = 1;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        *exponent = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      }  <span class="comment">// else fallthrough</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      *power = 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      *exponent = -1;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">// Following assignments are here to silence compiler warnings.</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      *power = 0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      *exponent = 0;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <a class="code" href="../../d5/d16/checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">// Generates the digits of input number w.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">// w is a floating-point number (DiyFp), consisting of a significand and an</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">// exponent. Its exponent is bounded by kMinimalTargetExponent and</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">// kMaximalTargetExponent.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">//       Hence -60 &lt;= w.e() &lt;= -32.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">// Returns false if it fails, in which case the generated digits in the buffer</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">// should not be used.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">// Preconditions:</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">//  * low, w and high are correct up to 1 ulp (unit in the last place). That</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">//    is, their error must be less than a unit of their last digits.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">//  * low.e() == w.e() == high.e()</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">//  * low &lt; w &lt; high, and taking into account their error: low~ &lt;= high~</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">//  * kMinimalTargetExponent &lt;= w.e() &lt;= kMaximalTargetExponent</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">// Postconditions: returns false if procedure fails.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">//   otherwise:</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">//     * buffer is not null-terminated, but len contains the number of digits.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">//     * buffer contains the shortest possible decimal digit-sequence</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">//       such that LOW &lt; buffer * 10^kappa &lt; HIGH, where LOW and HIGH are the</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">//       correct values of low and high (without their error).</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">//     * if more than one decimal representation gives the minimal number of</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">//       decimal digits then the one closest to W (where W is the correct value</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">//       of w) is chosen.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">// Remark: this procedure takes into account the imprecision of its input</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">//   numbers. If the precision is not enough to guarantee all the postconditions</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">//   then false is returned. This usually happens rarely (~0.5%).</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">// Say, for the sake of example, that</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">//   w.e() == -48, and w.f() == 0x1234567890abcdef</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">// w&#39;s value can be computed by w.f() * 2^w.e()</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">// We can obtain w&#39;s integral digits by simply shifting w.f() by -w.e().</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">//  -&gt; w&#39;s integral part is 0x1234</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">//  w&#39;s fractional part is therefore 0x567890abcdef.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">// Printing w&#39;s integral part is easy (simply print 0x1234 in decimal).</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">// In order to print its fraction we repeatedly multiply the fraction by 10 and</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">// get each digit. Example the first digit after the point would be computed by</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">//   (0x567890abcdef * 10) &gt;&gt; 48. -&gt; 3</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">// The whole thing becomes slightly more complicated because we want to stop</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">// once we have enough digits. That is, once the digits inside the buffer</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">// represent &#39;w&#39; we can stop. Everything inside the interval low - high</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">// represents w. However we have to pay attention to low, high and w&#39;s</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">// imprecision.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> DigitGen(DiyFp low,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                     DiyFp w,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                     DiyFp high,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                     Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                     <span class="keywordtype">int</span>* length,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                     <span class="keywordtype">int</span>* kappa) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(low.e() == w.e() &amp;&amp; w.e() == high.e());</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(low.f() + 1 &lt;= high.f() - 1);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(kMinimalTargetExponent &lt;= w.e() &amp;&amp; w.e() &lt;= kMaximalTargetExponent);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// low, w and high are imprecise, but by less than one ulp (unit in the last</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// place).</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">// If we remove (resp. add) 1 ulp from low (resp. high) we are certain that</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">// the new numbers are outside of the interval we want the final</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// representation to lie in.</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">// Inversely adding (resp. removing) 1 ulp from low (resp. high) would yield</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// numbers that are certain to lie in the interval. We will use this fact</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">// later on.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// We will now start by generating the digits within the uncertain</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">// interval. Later we will weed out representations that lie outside the safe</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// interval and thus _might_ lie outside the correct interval.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  uint64_t unit = 1;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  DiyFp too_low = DiyFp(low.f() - unit, low.e());</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  DiyFp too_high = DiyFp(high.f() + unit, high.e());</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// too_low and too_high are guaranteed to lie outside the interval we want the</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// generated number in.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  DiyFp unsafe_interval = <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a91f46411846f0bb1368147dfb476c82f">DiyFp::Minus</a>(too_high, too_low);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// We now cut the input number into two parts: the integral digits and the</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// fractionals. We will not write any decimal separator though, but adapt</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="comment">// kappa instead.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// Reminder: we are currently computing the digits (stored inside the buffer)</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">// such that:   too_low &lt; buffer * 10^kappa &lt; too_high</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// We use too_high for the digit_generation and stop as soon as possible.</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">// If we stop early we effectively round down.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  DiyFp one = DiyFp(static_cast&lt;uint64_t&gt;(1) &lt;&lt; -w.e(), w.e());</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// Division by one is a shift.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  uint32_t integrals = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(too_high.f() &gt;&gt; -one.e());</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">// Modulo by one is an and.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  uint64_t fractionals = too_high.f() &amp; (one.f() - 1);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  uint32_t divisor;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">int</span> divisor_exponent;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  BiggestPowerTen(integrals, <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a> - (-one.e()),</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                  &amp;divisor, &amp;divisor_exponent);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  *kappa = divisor_exponent + 1;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  *length = 0;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Loop invariant: buffer = too_high / 10^kappa  (integer division)</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="comment">// The invariant holds for the first iteration: kappa has been initialized</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">// with the divisor exponent + 1. And the divisor is the biggest power of ten</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// that is smaller than integrals.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">while</span> (*kappa &gt; 0) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">int</span> digit = integrals / divisor;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    buffer[*length] = <span class="charliteral">&#39;0&#39;</span> + digit;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    (*length)++;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    integrals %= divisor;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    (*kappa)--;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// Note that kappa now equals the exponent of the divisor and that the</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// invariant thus holds again.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    uint64_t rest =</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        (<span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(integrals) &lt;&lt; -one.e()) + fractionals;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">// Invariant: too_high = buffer * 10^kappa + DiyFp(rest, one.e())</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// Reminder: unsafe_interval.e() == one.e()</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span> (rest &lt; unsafe_interval.f()) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="comment">// Rounding down (by not emitting the remaining digits) yields a number</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">// that lies within the unsafe interval.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordflow">return</span> RoundWeed(buffer, *length, <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a91f46411846f0bb1368147dfb476c82f">DiyFp::Minus</a>(too_high, w).f(),</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                       unsafe_interval.<a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a410612fb1238dcaa32c964140f8a63b6">f</a>(), rest,</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                       <span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(divisor) &lt;&lt; -one.e(), unit);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    divisor /= 10;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// The integrals have been generated. We are at the point of the decimal</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// separator. In the following loop we simply multiply the remaining digits by</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">// 10 and divide by one. We just need to pay attention to multiply associated</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// data (like the interval or &#39;unit&#39;), too.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// Note that the multiplication by 10 does not overflow, because w.e &gt;= -60</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// and thus one.e &gt;= -60.</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(one.e() &gt;= -60);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(fractionals &lt; one.f());</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="../../d5/d87/globals_8h.html#a16f4f10e15ec96e47b104af5c33ec7da">V8_2PART_UINT64_C</a>(0xFFFFFFFF, FFFFFFFF) / 10 &gt;= one.f());</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    fractionals *= 10;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    unit *= 10;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    unsafe_interval.set_f(unsafe_interval.f() * 10);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// Integer division by one.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">int</span> digit = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(fractionals &gt;&gt; -one.e());</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    buffer[*length] = <span class="charliteral">&#39;0&#39;</span> + digit;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    (*length)++;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    fractionals &amp;= one.f() - 1;  <span class="comment">// Modulo by one.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    (*kappa)--;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (fractionals &lt; unsafe_interval.f()) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">return</span> RoundWeed(buffer, *length, <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a91f46411846f0bb1368147dfb476c82f">DiyFp::Minus</a>(too_high, w).f() * unit,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                       unsafe_interval.<a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a410612fb1238dcaa32c964140f8a63b6">f</a>(), fractionals, one.f(), unit);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">// Generates (at most) requested_digits of input number w.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">// w is a floating-point number (DiyFp), consisting of a significand and an</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">// exponent. Its exponent is bounded by kMinimalTargetExponent and</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">// kMaximalTargetExponent.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">//       Hence -60 &lt;= w.e() &lt;= -32.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">// Returns false if it fails, in which case the generated digits in the buffer</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">// should not be used.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">// Preconditions:</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">//  * w is correct up to 1 ulp (unit in the last place). That</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">//    is, its error must be strictly less than a unit of its last digit.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">//  * kMinimalTargetExponent &lt;= w.e() &lt;= kMaximalTargetExponent</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">// Postconditions: returns false if procedure fails.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">//   otherwise:</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">//     * buffer is not null-terminated, but length contains the number of</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//       digits.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//     * the representation in buffer is the most precise representation of</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">//       requested_digits digits.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//     * buffer contains at most requested_digits digits of w. If there are less</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">//       than requested_digits digits then some trailing &#39;0&#39;s have been removed.</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">//     * kappa is such that</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">//            w = buffer * 10^kappa + eps with |eps| &lt; 10^kappa / 2.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">// Remark: This procedure takes into account the imprecision of its input</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">//   numbers. If the precision is not enough to guarantee all the postconditions</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">//   then false is returned. This usually happens rarely, but the failure-rate</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">//   increases with higher requested_digits.</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> DigitGenCounted(DiyFp w,</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                            <span class="keywordtype">int</span> requested_digits,</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                            Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                            <span class="keywordtype">int</span>* length,</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                            <span class="keywordtype">int</span>* kappa) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(kMinimalTargetExponent &lt;= w.e() &amp;&amp; w.e() &lt;= kMaximalTargetExponent);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(kMinimalTargetExponent &gt;= -60);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(kMaximalTargetExponent &lt;= -32);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="comment">// w is assumed to have an error less than 1 unit. Whenever w is scaled we</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">// also scale its error.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  uint64_t w_error = 1;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// We cut the input number into two parts: the integral digits and the</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// fractional digits. We don&#39;t emit any decimal separator, but adapt kappa</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// instead. Example: instead of writing &quot;1.2&quot; we put &quot;12&quot; into the buffer and</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// increase kappa by 1.</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  DiyFp one = DiyFp(static_cast&lt;uint64_t&gt;(1) &lt;&lt; -w.e(), w.e());</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// Division by one is a shift.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  uint32_t integrals = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(w.f() &gt;&gt; -one.e());</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// Modulo by one is an and.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  uint64_t fractionals = w.f() &amp; (one.f() - 1);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  uint32_t divisor;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">int</span> divisor_exponent;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  BiggestPowerTen(integrals, <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a> - (-one.e()),</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                  &amp;divisor, &amp;divisor_exponent);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  *kappa = divisor_exponent + 1;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  *length = 0;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">// Loop invariant: buffer = w / 10^kappa  (integer division)</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// The invariant holds for the first iteration: kappa has been initialized</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">// with the divisor exponent + 1. And the divisor is the biggest power of ten</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// that is smaller than &#39;integrals&#39;.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">while</span> (*kappa &gt; 0) {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordtype">int</span> digit = integrals / divisor;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    buffer[*length] = <span class="charliteral">&#39;0&#39;</span> + digit;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    (*length)++;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    requested_digits--;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    integrals %= divisor;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    (*kappa)--;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// Note that kappa now equals the exponent of the divisor and that the</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// invariant thus holds again.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span> (requested_digits == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    divisor /= 10;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span> (requested_digits == 0) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    uint64_t rest =</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        (<span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(integrals) &lt;&lt; -one.e()) + fractionals;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">return</span> RoundWeedCounted(buffer, *length, rest,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                            static_cast&lt;uint64_t&gt;(divisor) &lt;&lt; -one.e(), w_error,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                            kappa);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">// The integrals have been generated. We are at the point of the decimal</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// separator. In the following loop we simply multiply the remaining digits by</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// 10 and divide by one. We just need to pay attention to multiply associated</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// data (the &#39;unit&#39;), too.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">// Note that the multiplication by 10 does not overflow, because w.e &gt;= -60</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">// and thus one.e &gt;= -60.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(one.e() &gt;= -60);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(fractionals &lt; one.f());</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(<a class="code" href="../../d5/d87/globals_8h.html#a16f4f10e15ec96e47b104af5c33ec7da">V8_2PART_UINT64_C</a>(0xFFFFFFFF, FFFFFFFF) / 10 &gt;= one.f());</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">while</span> (requested_digits &gt; 0 &amp;&amp; fractionals &gt; w_error) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    fractionals *= 10;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    w_error *= 10;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// Integer division by one.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">int</span> digit = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(fractionals &gt;&gt; -one.e());</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    buffer[*length] = <span class="charliteral">&#39;0&#39;</span> + digit;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    (*length)++;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    requested_digits--;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    fractionals &amp;= one.f() - 1;  <span class="comment">// Modulo by one.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    (*kappa)--;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">if</span> (requested_digits != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">return</span> RoundWeedCounted(buffer, *length, fractionals, one.f(), w_error,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                          kappa);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">// Provides a decimal representation of v.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">// Returns true if it succeeds, otherwise the result cannot be trusted.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">// There will be *length digits inside the buffer (not null-terminated).</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">// If the function returns true then</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">//        v == (double) (buffer * 10^decimal_exponent).</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">// The digits in the buffer are the shortest representation possible: no</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">// 0.09999999999999999 instead of 0.1. The shorter representation will even be</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">// chosen even if the longer one would be closer to v.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">// The last digit will be closest to the actual v. That is, even if several</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">// digits might correctly yield &#39;v&#39; when read again, the closest will be</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">// computed.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Grisu3(<span class="keywordtype">double</span> v,</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                   Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                   <span class="keywordtype">int</span>* length,</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                   <span class="keywordtype">int</span>* decimal_exponent) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  DiyFp w = Double(v).AsNormalizedDiyFp();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// boundary_minus and boundary_plus are the boundaries between v and its</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">// closest floating-point neighbors. Any number strictly between</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// boundary_minus and boundary_plus will round to v when convert to a double.</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">// Grisu3 will never output representations that lie exactly on a boundary.</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  DiyFp boundary_minus, boundary_plus;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  Double(v).NormalizedBoundaries(&amp;boundary_minus, &amp;boundary_plus);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(boundary_plus.e() == w.e());</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  DiyFp ten_mk;  <span class="comment">// Cached power of ten: 10^-k</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordtype">int</span> mk;        <span class="comment">// -k</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordtype">int</span> ten_mk_minimal_binary_exponent =</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;     kMinimalTargetExponent - (w.e() + <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordtype">int</span> ten_mk_maximal_binary_exponent =</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;     kMaximalTargetExponent - (w.e() + <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="../../d7/d52/classv8_1_1internal_1_1_powers_of_ten_cache.html#a484380b0777a7b3c013d8433b7d03416">PowersOfTenCache::GetCachedPowerForBinaryExponentRange</a>(</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      ten_mk_minimal_binary_exponent,</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      ten_mk_maximal_binary_exponent,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      &amp;ten_mk, &amp;mk);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>((kMinimalTargetExponent &lt;= w.e() + ten_mk.e() +</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>) &amp;&amp;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;         (kMaximalTargetExponent &gt;= w.e() + ten_mk.e() +</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>));</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// Note that ten_mk is only an approximation of 10^-k. A DiyFp only contains a</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">// 64 bit significand and ten_mk is thus only precise up to 64 bits.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// The DiyFp::Times procedure rounds its result, and ten_mk is approximated</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// too. The variable scaled_w (as well as scaled_boundary_minus/plus) are now</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// off by a small amount.</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// In fact: scaled_w - w*10^k &lt; 1ulp (unit in the last place) of scaled_w.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">// In other words: let f = scaled_w.f() and e = scaled_w.e(), then</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="comment">//           (f-1) * 2^e &lt; w*10^k &lt; (f+1) * 2^e</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  DiyFp scaled_w = <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a81fda2a51ea1c4635b7fdce45b776896">DiyFp::Times</a>(w, ten_mk);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(scaled_w.e() ==</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;         boundary_plus.e() + ten_mk.e() + <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// In theory it would be possible to avoid some recomputations by computing</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// the difference between w and boundary_minus/plus (a power of 2) and to</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// compute scaled_boundary_minus/plus by subtracting/adding from</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">// scaled_w. However the code becomes much less readable and the speed</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// enhancements are not terriffic.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  DiyFp scaled_boundary_minus = <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a81fda2a51ea1c4635b7fdce45b776896">DiyFp::Times</a>(boundary_minus, ten_mk);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  DiyFp scaled_boundary_plus  = <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a81fda2a51ea1c4635b7fdce45b776896">DiyFp::Times</a>(boundary_plus,  ten_mk);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">// DigitGen will generate the digits of scaled_w. Therefore we have</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="comment">// v == (double) (scaled_w * 10^-mk).</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="comment">// Set decimal_exponent == -mk and pass it to DigitGen. If scaled_w is not an</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="comment">// integer than it will be updated. For instance if scaled_w == 1.23 then</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// the buffer will be filled with &quot;123&quot; und the decimal_exponent will be</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="comment">// decreased by 2.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordtype">int</span> kappa;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordtype">bool</span> result = DigitGen(scaled_boundary_minus, scaled_w, scaled_boundary_plus,</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                         buffer, length, &amp;kappa);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  *decimal_exponent = -mk + kappa;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">// The &quot;counted&quot; version of grisu3 (see above) only generates requested_digits</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">// number of digits. This version does not generate the shortest representation,</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">// and with enough requested digits 0.1 will at some point print as 0.9999999...</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">// Grisu3 is too imprecise for real halfway cases (1.5 will not work) and</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">// therefore the rounding strategy for halfway cases is irrelevant.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> Grisu3Counted(<span class="keywordtype">double</span> v,</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                          <span class="keywordtype">int</span> requested_digits,</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                          Vector&lt;char&gt; buffer,</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                          <span class="keywordtype">int</span>* length,</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                          <span class="keywordtype">int</span>* decimal_exponent) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  DiyFp w = Double(v).AsNormalizedDiyFp();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  DiyFp ten_mk;  <span class="comment">// Cached power of ten: 10^-k</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordtype">int</span> mk;        <span class="comment">// -k</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordtype">int</span> ten_mk_minimal_binary_exponent =</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;     kMinimalTargetExponent - (w.e() + <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordtype">int</span> ten_mk_maximal_binary_exponent =</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;     kMaximalTargetExponent - (w.e() + <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <a class="code" href="../../d7/d52/classv8_1_1internal_1_1_powers_of_ten_cache.html#a484380b0777a7b3c013d8433b7d03416">PowersOfTenCache::GetCachedPowerForBinaryExponentRange</a>(</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      ten_mk_minimal_binary_exponent,</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      ten_mk_maximal_binary_exponent,</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      &amp;ten_mk, &amp;mk);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>((kMinimalTargetExponent &lt;= w.e() + ten_mk.e() +</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>) &amp;&amp;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         (kMaximalTargetExponent &gt;= w.e() + ten_mk.e() +</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">DiyFp::kSignificandSize</a>));</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">// Note that ten_mk is only an approximation of 10^-k. A DiyFp only contains a</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// 64 bit significand and ten_mk is thus only precise up to 64 bits.</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// The DiyFp::Times procedure rounds its result, and ten_mk is approximated</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="comment">// too. The variable scaled_w (as well as scaled_boundary_minus/plus) are now</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="comment">// off by a small amount.</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">// In fact: scaled_w - w*10^k &lt; 1ulp (unit in the last place) of scaled_w.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">// In other words: let f = scaled_w.f() and e = scaled_w.e(), then</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="comment">//           (f-1) * 2^e &lt; w*10^k &lt; (f+1) * 2^e</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  DiyFp scaled_w = <a class="code" href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a81fda2a51ea1c4635b7fdce45b776896">DiyFp::Times</a>(w, ten_mk);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// We now have (double) (scaled_w * 10^-mk).</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// DigitGen will generate the first requested_digits digits of scaled_w and</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// return together with a kappa such that scaled_w ~= buffer * 10^kappa. (It</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// will not always be exactly the same since DigitGenCounted only produces a</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="comment">// limited number of digits.)</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordtype">int</span> kappa;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">bool</span> result = DigitGenCounted(scaled_w, requested_digits,</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                buffer, length, &amp;kappa);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  *decimal_exponent = -mk + kappa;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;}</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno"><a class="line" href="../../d4/d32/namespacev8_1_1internal.html#a06a50e9391336391cb8771c3cf718e0c">  709</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d32/namespacev8_1_1internal.html#a06a50e9391336391cb8771c3cf718e0c">FastDtoa</a>(<span class="keywordtype">double</span> v,</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;              <a class="code" href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0">FastDtoaMode</a> <a class="code" href="../../d4/d32/namespacev8_1_1internal.html#a5adc5ec2f1a2af41381abab75250b1c8">mode</a>,</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;              <span class="keywordtype">int</span> requested_digits,</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;              <a class="code" href="../../d5/d7d/classv8_1_1internal_1_1_vector.html">Vector&lt;char&gt;</a> buffer,</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;              <span class="keywordtype">int</span>* length,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;              <span class="keywordtype">int</span>* decimal_point) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(v &gt; 0);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <a class="code" href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a>(!<a class="code" href="../../da/d62/classv8_1_1internal_1_1_double.html">Double</a>(v).IsSpecial());</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordtype">int</span> decimal_exponent = 0;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">switch</span> (mode) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0ac5a1c6dea4ebe97497b7d99ba3c7f4b6">FAST_DTOA_SHORTEST</a>:</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      result = Grisu3(v, buffer, length, &amp;decimal_exponent);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0a5d0274a20a491aabd8e14cd8bbdfb58f">FAST_DTOA_PRECISION</a>:</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      result = Grisu3Counted(v, requested_digits,</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                             buffer, length, &amp;decimal_exponent);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <a class="code" href="../../d5/d16/checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordflow">if</span> (result) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    *decimal_point = *length + decimal_exponent;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    buffer[*length] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;} }  <span class="comment">// namespace v8::internal</span></div>
<div class="ttc" id="double_8h_html"><div class="ttname"><a href="../../d9/d6e/double_8h.html">double.h</a></div></div>
<div class="ttc" id="fast-dtoa_8h_html"><div class="ttname"><a href="../../dd/df7/fast-dtoa_8h.html">fast-dtoa.h</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_vector_html"><div class="ttname"><a href="../../d5/d7d/classv8_1_1internal_1_1_vector.html">v8::internal::Vector&lt; char &gt;</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_diy_fp_html_a91f46411846f0bb1368147dfb476c82f"><div class="ttname"><a href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a91f46411846f0bb1368147dfb476c82f">v8::internal::DiyFp::Minus</a></div><div class="ttdeci">static DiyFp Minus(const DiyFp &amp;a, const DiyFp &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d85/diy-fp_8h_source.html#l00059">diy-fp.h:59</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_diy_fp_html_a46159ce3811a3de060ddd60a4cb7028d"><div class="ttname"><a href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a46159ce3811a3de060ddd60a4cb7028d">v8::internal::DiyFp::kSignificandSize</a></div><div class="ttdeci">static const int kSignificandSize</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d85/diy-fp_8h_source.html#l00041">diy-fp.h:41</a></div></div>
<div class="ttc" id="checks_8h_html"><div class="ttname"><a href="../../d5/d16/checks_8h.html">checks.h</a></div></div>
<div class="ttc" id="namespacev8_1_1internal_html_a0a3a65d1a8a9b7b16773b5a15420dde0a5d0274a20a491aabd8e14cd8bbdfb58f"><div class="ttname"><a href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0a5d0274a20a491aabd8e14cd8bbdfb58f">v8::internal::FAST_DTOA_PRECISION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df7/fast-dtoa_8h_source.html#l00041">fast-dtoa.h:41</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_diy_fp_html_a410612fb1238dcaa32c964140f8a63b6"><div class="ttname"><a href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a410612fb1238dcaa32c964140f8a63b6">v8::internal::DiyFp::f</a></div><div class="ttdeci">uint64_t f() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d85/diy-fp_8h_source.html#l00102">diy-fp.h:102</a></div></div>
<div class="ttc" id="checks_8h_html_ac22830a985e1daed0c9eadba8c6f606e"><div class="ttname"><a href="../../d5/d16/checks_8h.html#ac22830a985e1daed0c9eadba8c6f606e">ASSERT</a></div><div class="ttdeci">#define ASSERT(condition)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/checks_8h_source.html#l00329">checks.h:329</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div></div>
<div class="ttc" id="namespacev8_1_1internal_html_a0a3a65d1a8a9b7b16773b5a15420dde0"><div class="ttname"><a href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0">v8::internal::FastDtoaMode</a></div><div class="ttdeci">FastDtoaMode</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df7/fast-dtoa_8h_source.html#l00034">fast-dtoa.h:34</a></div></div>
<div class="ttc" id="checks_8h_html_a0bc63b24b654ca433be7b97a3edde132"><div class="ttname"><a href="../../d5/d16/checks_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a></div><div class="ttdeci">#define UNREACHABLE()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/checks_8h_source.html#l00052">checks.h:52</a></div></div>
<div class="ttc" id="namespacev8_1_1internal_html_a5adc5ec2f1a2af41381abab75250b1c8"><div class="ttname"><a href="../../d4/d32/namespacev8_1_1internal.html#a5adc5ec2f1a2af41381abab75250b1c8">v8::internal::mode</a></div><div class="ttdeci">enable upcoming ES6 features enable harmony block scoping enable harmony enable harmony proxies enable harmony generators enable harmony numeric enable harmony string enable harmony math functions harmony_scoping harmony_symbols harmony_collections harmony_iteration harmony_strings harmony_scoping harmony_maths tracks arrays with only smi values Optimize object Array DOM strings and string pretenure call new trace pretenuring decisions of HAllocate instructions track fields with only smi values track fields with heap values track_fields track_fields Enables optimizations which favor memory size over execution speed use string slices optimization filter maximum number of GVN fix point iterations use function inlining use allocation folding eliminate write barriers targeting allocations in optimized code maximum source size in bytes considered for a single inlining maximum cumulative number of AST nodes considered for inlining crankshaft harvests type feedback from stub cache trace check elimination phase hydrogen tracing filter trace hydrogen to given file name trace inlining decisions trace store elimination trace all use positions trace global value numbering trace hydrogen escape analysis trace the tracking of allocation sites trace map generalization environment for every instruction deoptimize every n garbage collections put a break point before deoptimizing deoptimize uncommon cases use on stack replacement trace array bounds check elimination perform array index dehoisting use load elimination use store elimination use constant folding eliminate unreachable code number of stress runs when picking a function to watch for shared function not JSFunction itself flushes the cache of optimized code for closures on every GC functions with arguments object maximum number of escape analysis fix point iterations allow uint32 values on optimize frames if they are used only in safe operations track concurrent recompilation artificial compilation delay in ms concurrent on stack replacement do not emit check maps for constant values that have a leaf deoptimize the optimized code if the layout of the maps changes number of stack frames inspected by the profiler percentage of ICs that must have type info to allow optimization extra verbose compilation tracing generate extra emit comments in code disassembly enable use of SSE3 instructions if available enable use of CMOV instruction if available enable use of VFP3 instructions if available enable use of NEON instructions if enable use of SDIV and UDIV instructions if enable loading bit constant by means of movw movt instruction enable unaligned accesses for enable use of d16 d31 registers on ARM this requires VFP3 force all emitted branches to be in long mode(MIPS only)&quot;)  DEFINE_string(expose_natives_as</div></div>
<div class="ttc" id="namespacev8_1_1internal_html_a06a50e9391336391cb8771c3cf718e0c"><div class="ttname"><a href="../../d4/d32/namespacev8_1_1internal.html#a06a50e9391336391cb8771c3cf718e0c">v8::internal::FastDtoa</a></div><div class="ttdeci">bool FastDtoa(double v, FastDtoaMode mode, int requested_digits, Vector&lt; char &gt; buffer, int *length, int *decimal_point)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d2d/fast-dtoa_8cc_source.html#l00709">fast-dtoa.cc:709</a></div></div>
<div class="ttc" id="globals_8h_html_a16f4f10e15ec96e47b104af5c33ec7da"><div class="ttname"><a href="../../d5/d87/globals_8h.html#a16f4f10e15ec96e47b104af5c33ec7da">V8_2PART_UINT64_C</a></div><div class="ttdeci">#define V8_2PART_UINT64_C(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d87/globals_8h_source.html#l00226">globals.h:226</a></div></div>
<div class="ttc" id="cached-powers_8h_html"><div class="ttname"><a href="../../db/d1a/cached-powers_8h.html">cached-powers.h</a></div></div>
<div class="ttc" id="namespacev8_1_1internal_html_a0a3a65d1a8a9b7b16773b5a15420dde0ac5a1c6dea4ebe97497b7d99ba3c7f4b6"><div class="ttname"><a href="../../d4/d32/namespacev8_1_1internal.html#a0a3a65d1a8a9b7b16773b5a15420dde0ac5a1c6dea4ebe97497b7d99ba3c7f4b6">v8::internal::FAST_DTOA_SHORTEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df7/fast-dtoa_8h_source.html#l00038">fast-dtoa.h:38</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_diy_fp_html_a81fda2a51ea1c4635b7fdce45b776896"><div class="ttname"><a href="../../da/d16/classv8_1_1internal_1_1_diy_fp.html#a81fda2a51ea1c4635b7fdce45b776896">v8::internal::DiyFp::Times</a></div><div class="ttdeci">static DiyFp Times(const DiyFp &amp;a, const DiyFp &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d85/diy-fp_8h_source.html#l00070">diy-fp.h:70</a></div></div>
<div class="ttc" id="diy-fp_8h_html"><div class="ttname"><a href="../../d0/d85/diy-fp_8h.html">diy-fp.h</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_powers_of_ten_cache_html_a484380b0777a7b3c013d8433b7d03416"><div class="ttname"><a href="../../d7/d52/classv8_1_1internal_1_1_powers_of_ten_cache.html#a484380b0777a7b3c013d8433b7d03416">v8::internal::PowersOfTenCache::GetCachedPowerForBinaryExponentRange</a></div><div class="ttdeci">static void GetCachedPowerForBinaryExponentRange(int min_exponent, int max_exponent, DiyFp *power, int *decimal_exponent)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d59/cached-powers_8cc_source.html#l00147">cached-powers.cc:147</a></div></div>
<div class="ttc" id="classv8_1_1internal_1_1_double_html"><div class="ttname"><a href="../../da/d62/classv8_1_1internal_1_1_double.html">v8::internal::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6e/double_8h_source.html#l00041">double.h:41</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../d1/d2d/fast-dtoa_8cc.html">fast-dtoa.cc</a></li>
    <li class="footer">Generated on Sat Jun 7 2014 23:54:10 for v8 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
